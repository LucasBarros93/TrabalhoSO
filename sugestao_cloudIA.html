<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Intersection - OS Threading Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
        }
        
        .stat {
            text-align: center;
        }
        
        .intersection {
            width: 400px;
            height: 400px;
            margin: 20px auto;
            position: relative;
            background: #333;
            border-radius: 10px;
        }
        
        .road {
            position: absolute;
            background: #666;
        }
        
        .road-horizontal {
            width: 100%;
            height: 120px;
            top: 140px;
        }
        
        .road-vertical {
            width: 120px;
            height: 100%;
            left: 140px;
        }
        
        .lane {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 2px solid #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            background: rgba(0,0,0,0.3);
        }
        
        .lane:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255,255,255,0.3);
        }
        
        .lane.active {
            background: rgba(0,255,0,0.4);
            border-color: #0f0;
            box-shadow: 0 0 20px rgba(0,255,0,0.5);
        }
        
        .lane.paused {
            background: rgba(255,165,0,0.4);
            border-color: #ffa500;
            animation: pausePulse 1.5s infinite;
        }
        
        @keyframes pausePulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .lane-north { top: 20px; left: 160px; }
        .lane-south { bottom: 20px; left: 160px; }
        .lane-east { right: 20px; top: 160px; }
        .lane-west { left: 20px; top: 160px; }
        
        .lane-name {
            font-size: 9px;
            margin-bottom: 5px;
            color: #fff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .lane-info {
            font-size: 8px;
            color: #ccc;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .car {
            width: 20px;
            height: 12px;
            border-radius: 2px;
            position: absolute;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.4);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .car.normal { 
            background: linear-gradient(135deg, #4CAF50, #45a049);
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.3);
        }
        
        .car.priority { 
            background: linear-gradient(135deg, #2196F3, #1976D2);
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.3);
            border: 2px solid #fff;
            animation: priorityBlink 1.5s infinite;
        }
        
        .car.urgent { 
            background: linear-gradient(135deg, #F44336, #d32f2f);
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.3);
            border: 2px solid #FFD700;
            animation: urgentBlink 0.8s infinite;
        }
        
        .car.crossing {
            z-index: 20;
            transform: scale(1.5);
            box-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(0,255,0,0.4);
            border: 2px solid #fff;
        }
        
        .car::before {
            content: '';
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            top: 2px;
            left: 2px;
        }
        
        .car.priority::after {
            content: 'P';
            position: absolute;
            font-size: 6px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.8);
        }
        
        .car.urgent::after {
            content: '!';
            position: absolute;
            font-size: 8px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.8);
        }
        
        @keyframes priorityBlink {
            0%, 100% { border-color: #fff; }
            50% { border-color: #2196F3; }
        }
        
        @keyframes urgentBlink {
            0%, 100% { border-color: #FFD700; }
            50% { border-color: #FF6B6B; }
        }
        
        @keyframes crossIntersection {
            0% { 
                transform: scale(1.5);
                box-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(0,255,0,0.4);
            }
            25% { 
                transform: scale(1.5) rotate(2deg);
                box-shadow: 0 0 25px rgba(255,255,255,0.9), 0 0 50px rgba(0,255,0,0.6);
            }
            75% { 
                transform: scale(1.5) rotate(-2deg);
                box-shadow: 0 0 25px rgba(255,255,255,0.9), 0 0 50px rgba(0,255,0,0.6);
            }
            100% { 
                transform: scale(1.5);
                box-shadow: 0 0 30px rgba(255,255,255,1), 0 0 60px rgba(0,255,0,0.8);
            }
        }
        
        .queue-container {
            position: absolute;
            pointer-events: none;
        }
        
        .queue-north { 
            top: 100px; 
            left: 160px; 
            width: 80px; 
            height: 60px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 2px;
        }
        
        .queue-south { 
            bottom: 100px; 
            left: 160px; 
            width: 80px; 
            height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        
        .queue-east { 
            right: 100px; 
            top: 160px; 
            width: 60px; 
            height: 80px;
            display: flex;
            flex-direction: row-reverse;
            align-items: center;
            gap: 2px;
        }
        
        .queue-west { 
            left: 100px; 
            top: 160px; 
            width: 60px; 
            height: 80px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 2px;
        }
        
        .queue-display {
            position: absolute;
            font-size: 9px;
            color: white;
            font-weight: bold;
            background: rgba(0,0,0,0.7);
            padding: 2px 6px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.3);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            white-space: nowrap;
            z-index: 15;
        }
        
        .queue-north { top: -25px; left: 50%; transform: translateX(-50%); }
        .queue-south { bottom: -25px; left: 50%; transform: translateX(-50%); }
        .queue-east { right: -5px; top: -25px; }
        .queue-west { left: -5px; top: -25px; }
        
        .game-paused {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: #ffa500;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            border: 3px solid #ffa500;
            z-index: 100;
            animation: pausePulse 1.5s infinite;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .explanation {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .warning {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .success {
            color: #51cf66;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>🚦 Traffic Intersection - OS Threading Simulator</h1>
            <p>Learn about threads, semaphores, and process scheduling!</p>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div>Cars Processed</div>
                <div id="processed">0</div>
            </div>
            <div class="stat">
                <div>Current Score</div>
                <div id="score">0</div>
            </div>
            <div class="stat">
                <div>Timeouts</div>
                <div id="timeouts">0</div>
            </div>
            <div class="stat">
                <div>Game Time</div>
                <div id="gameTime">0s</div>
            </div>
        </div>
        
        <div class="intersection">
            <div class="road road-horizontal"></div>
            <div class="road road-vertical"></div>
            
            <div class="lane lane-north" data-direction="north">
                <div class="lane-name">NORTH</div>
                <div class="lane-info" id="lane-info-north">Ready</div>
                <div class="queue-display queue-north" id="queue-north">Queue: 0</div>
            </div>
            <div class="lane lane-south" data-direction="south">
                <div class="lane-name">SOUTH</div>
                <div class="lane-info" id="lane-info-south">Ready</div>
                <div class="queue-display queue-south" id="queue-south">Queue: 0</div>
            </div>
            <div class="lane lane-east" data-direction="east">
                <div class="lane-name">EAST</div>
                <div class="lane-info" id="lane-info-east">Ready</div>
                <div class="queue-display queue-east" id="queue-east">Queue: 0</div>
            </div>
            <div class="lane lane-west" data-direction="west">
                <div class="lane-name">WEST</div>
                <div class="lane-info" id="lane-info-west">Ready</div>
                <div class="queue-display queue-west" id="queue-west">Queue: 0</div>
            </div>
            
            <!-- Queue containers for visual car display -->
            <div class="queue-container queue-north" id="visual-queue-north"></div>
            <div class="queue-container queue-south" id="visual-queue-south"></div>
            <div class="queue-container queue-east" id="visual-queue-east"></div>
            <div class="queue-container queue-west" id="visual-queue-west"></div>
            
            <!-- Pause overlay -->
            <div class="game-paused" id="pause-overlay" style="display: none;">
                ⏸️ GAME PAUSED
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" onclick="startGame()">Start Game</button>
            <button class="btn" onclick="pauseGame()">Pause</button>
            <button class="btn" onclick="resetGame()">Reset</button>
        </div>
        
        <div class="explanation">
            <h3>🎓 Operating Systems Concepts</h3>
            <p><strong>Threads:</strong> Each car represents a thread (process) that needs CPU time</p>
            <p><strong>Semaphores:</strong> The intersection is a critical section that only one car can use at a time</p>
            <p><strong>Scheduling:</strong> You act as the OS scheduler, deciding which thread gets to execute next</p>
            <p><strong>Priority:</strong> 🚗 Normal cars, 🚓 Police (high priority), 🚑 Ambulance (highest priority)</p>
            <p><strong>Starvation:</strong> Cars have maximum wait times - if exceeded, they timeout (like process starvation)</p>
            <br>
            <p><strong>How to Play:</strong> Click on a lane to let the next car pass. Prioritize emergency vehicles and avoid timeouts!</p>
        </div>
    </div>

    <script>
        class TrafficGame {
            constructor() {
                this.lanes = {
                    north: [],
                    south: [],
                    east: [],
                    west: []
                };
                
                this.stats = {
                    processed: 0,
                    score: 0,
                    timeouts: 0,
                    gameTime: 0
                };
                
                this.gameRunning = false;
                this.gameInterval = null;
                this.spawnInterval = null;
                this.currentLane = null;
                
                this.carTypes = [
                    { type: 'normal', symbol: '🚗', priority: 1, maxWait: 15, points: 10 },
                    { type: 'priority', symbol: '🚓', priority: 2, maxWait: 10, points: 20 },
                    { type: 'urgent', symbol: '🚑', priority: 3, maxWait: 8, points: 30 }
                ];
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                document.querySelectorAll('.lane').forEach(lane => {
                    lane.addEventListener('click', () => {
                        const direction = lane.dataset.direction;
                        this.processLane(direction);
                    });
                });
            }
            
            startGame() {
                if (this.gameRunning) return;
                
                this.gameRunning = true;
                this.gameInterval = setInterval(() => this.updateGame(), 1000);
                this.spawnInterval = setInterval(() => this.spawnCar(), 2000);
                
                // Hide pause overlay and reset lane styles
                document.getElementById('pause-overlay').style.display = 'none';
                document.querySelectorAll('.lane').forEach(lane => {
                    lane.classList.remove('paused');
                });
            }
            
            pauseGame() {
                this.gameRunning = false;
                clearInterval(this.gameInterval);
                clearInterval(this.spawnInterval);
                
                // Show pause overlay and update lanes
                document.getElementById('pause-overlay').style.display = 'block';
                document.querySelectorAll('.lane').forEach(lane => {
                    lane.classList.add('paused');
                });
            }
            
            resetGame() {
                this.pauseGame();
                this.lanes = { north: [], south: [], east: [], west: [] };
                this.stats = { processed: 0, score: 0, timeouts: 0, gameTime: 0 };
                this.updateDisplay();
                this.clearActiveLane();
                
                // Hide pause overlay and reset lanes
                document.getElementById('pause-overlay').style.display = 'none';
                document.querySelectorAll('.lane').forEach(lane => {
                    lane.classList.remove('paused');
                });
            }
            
            spawnCar() {
                if (!this.gameRunning) return;
                
                const directions = ['north', 'south', 'east', 'west'];
                const direction = directions[Math.floor(Math.random() * directions.length)];
                
                // Determine car type with weighted probability
                const rand = Math.random();
                let carType;
                if (rand < 0.7) carType = this.carTypes[0]; // 70% normal
                else if (rand < 0.9) carType = this.carTypes[1]; // 20% priority  
                else carType = this.carTypes[2]; // 10% urgent
                
                const car = {
                    id: Date.now() + Math.random(),
                    ...carType,
                    waitTime: 0,
                    spawnTime: this.stats.gameTime
                };
                
                this.lanes[direction].push(car);
                this.updateDisplay();
                this.animateCarSpawn(direction);
            }
            
            updateGame() {
                if (!this.gameRunning) return;
                
                this.stats.gameTime++;
                
                // Update wait times and check for timeouts
                Object.keys(this.lanes).forEach(direction => {
                    this.lanes[direction] = this.lanes[direction].filter(car => {
                        car.waitTime++;
                        if (car.waitTime >= car.maxWait) {
                            this.stats.timeouts++;
                            this.stats.score -= 20; // Penalty for timeout
                            return false; // Remove timed out car
                        }
                        return true;
                    });
                });
                
                this.updateDisplay();
            }
            
            processLane(direction) {
                if (!this.gameRunning || this.lanes[direction].length === 0) return;
                
                // Sort by priority, then by wait time
                this.lanes[direction].sort((a, b) => {
                    if (a.priority !== b.priority) return b.priority - a.priority;
                    return b.waitTime - a.waitTime;
                });
                
                const car = this.lanes[direction].shift();
                this.stats.processed++;
                this.stats.score += car.points;
                
                // Bonus points for processing high-priority cars quickly
                if (car.priority > 1 && car.waitTime < car.maxWait / 2) {
                    this.stats.score += 10;
                }
                
                this.showActiveLane(direction);
                this.animateCarCrossing(direction, car);
                this.updateDisplay();
            }
            
            showActiveLane(direction) {
                this.clearActiveLane();
                const lane = document.querySelector(`.lane-${direction}`);
                lane.classList.add('active');
                this.currentLane = direction;
                
                setTimeout(() => this.clearActiveLane(), 1000);
            }
            
            clearActiveLane() {
                document.querySelectorAll('.lane').forEach(lane => {
                    lane.classList.remove('active');
                });
                this.currentLane = null;
            }
            
            updateDisplay() {
                // Update stats
                document.getElementById('processed').textContent = this.stats.processed;
                document.getElementById('score').textContent = this.stats.score;
                document.getElementById('timeouts').textContent = this.stats.timeouts;
                document.getElementById('gameTime').textContent = this.stats.gameTime + 's';
                
                // Update queue displays and lane info
                Object.keys(this.lanes).forEach(direction => {
                    const queueElement = document.getElementById(`queue-${direction}`);
                    const laneInfoElement = document.getElementById(`lane-info-${direction}`);
                    const queue = this.lanes[direction];
                    
                    // Update queue display
                    let queueText = `Queue: ${queue.length}`;
                    let laneInfoText = 'Ready';
                    
                    if (queue.length > 0) {
                        const priorityCounts = { normal: 0, priority: 0, urgent: 0 };
                        queue.forEach(car => priorityCounts[car.type]++);
                        
                        // Simplified queue display
                        if (priorityCounts.urgent > 0) queueText = `🚨 ${queue.length} cars`;
                        else if (priorityCounts.priority > 0) queueText = `🚔 ${queue.length} cars`;
                        else queueText = `🚗 ${queue.length} cars`;
                        
                        // Update lane info
                        const nextCar = queue[0];
                        if (nextCar) {
                            const timeLeft = nextCar.maxWait - nextCar.waitTime;
                            laneInfoText = `Next: ${nextCar.type} (${timeLeft}s)`;
                        }
                        
                        // Check for urgent cars near timeout
                        const urgentCar = queue.find(car => car.priority >= 2 && car.waitTime >= car.maxWait - 3);
                        if (urgentCar) {
                            queueElement.className = 'queue-display queue-' + direction + ' warning';
                            laneInfoElement.className = 'lane-info warning';
                        } else {
                            queueElement.className = 'queue-display queue-' + direction;
                            laneInfoElement.className = 'lane-info';
                        }
                    } else {
                        queueElement.className = 'queue-display queue-' + direction;
                        laneInfoElement.className = 'lane-info';
                    }
                    
                    queueElement.textContent = queueText;
                    laneInfoElement.textContent = laneInfoText;
                });
                
                // Update visual queues
                this.updateVisualQueues();
            }
            
            updateVisualQueues() {
                Object.keys(this.lanes).forEach(direction => {
                    const container = document.getElementById(`visual-queue-${direction}`);
                    container.innerHTML = '';
                    
                    // Show only first 5 cars to avoid overcrowding
                    const carsToShow = this.lanes[direction].slice(0, 5);
                    
                    carsToShow.forEach((car, index) => {
                        const carElement = document.createElement('div');
                        carElement.className = `car ${car.type}`;
                        carElement.textContent = car.symbol;
                        carElement.style.opacity = Math.max(0.4, 1 - (index * 0.15)); // Fade cars further back
                        container.appendChild(carElement);
                    });
                });
            }
            
            animateCarSpawn(direction) {
                // Visual feedback for new car arrival
                const lane = document.querySelector(`.lane-${direction}`);
                lane.style.transform = 'scale(1.05)';
                lane.style.background = 'rgba(255, 255, 0, 0.2)';
                
                setTimeout(() => {
                    lane.style.transform = '';
                    lane.style.background = '';
                }, 300);
            }
            
            animateCarCrossing(direction, car) {
                const intersection = document.querySelector('.intersection');
                const carElement = document.createElement('div');
                carElement.className = `car ${car.type} crossing`;
                carElement.textContent = car.symbol;
                carElement.style.animation = 'crossIntersection 1.5s ease-in-out';
                
                // Position car at the start of crossing based on direction
                const startPositions = {
                    north: { left: '185px', top: '140px' },
                    south: { left: '185px', top: '245px' },
                    east: { left: '240px', top: '185px' },
                    west: { left: '140px', top: '185px' }
                };
                
                const endPositions = {
                    north: { left: '185px', top: '245px' },
                    south: { left: '185px', top: '140px' },
                    east: { left: '140px', top: '185px' },
                    west: { left: '240px', top: '185px' }
                };
                
                Object.assign(carElement.style, startPositions[direction]);
                intersection.appendChild(carElement);
                
                // Animate crossing
                setTimeout(() => {
                    Object.assign(carElement.style, {
                        ...endPositions[direction],
                        transition: 'all 1.2s cubic-bezier(0.25, 0.8, 0.25, 1)'
                    });
                }, 100);
                
                // Remove car after animation
                setTimeout(() => {
                    if (carElement.parentNode) {
                        carElement.remove();
                    }
                }, 1500);
            }
        }
        
        // Initialize game
        const game = new TrafficGame();
        
        // Global functions for buttons
        function startGame() { game.startGame(); }
        function pauseGame() { game.pauseGame(); }
        function resetGame() { game.resetGame(); }
        
        // Initial display update
        game.updateDisplay();
    </script>
</body>
</html>